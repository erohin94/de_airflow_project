## Описание

Задача пайплайна — скачать сырые данные с сайта, трансформировать их в колоночный формат Parquet и загрузить в S3. 

В качестве хранилища буду использовать сервис Minio полностью совместимый с S3 файловый сервер, поэтому Apache Airflow будет работать с ним как с AWS S3 
(Это популярный сервис для хранения файлов от компании Amazon, также S3 можно рассматривать как распределенную файловую систему.).

## Структура пайплайна

Пайплайн (DAG) будет состоять из следующих операторов:

`SimpleHttpOperator` - для проверки существования файла на сервере перед его загрузкой

`2 PythonOperator`:

`download_file` — загрузка файла с сайта и перекладывание на S3 в сжатом виде (gzip)

`to_parquet` — оператор скачивает файл, загруженный предыдущим оператором, и трансформирует его в формат Parquet, сохраняя результат в S3.

Выполнение последующего шага зависит от успешности предыдущего. Если необходимого файла на сервере нет (check_file), то выполнение загрузки нецелесообразно (download_file), за этим строго следит Airflow.

## Формат

Буду использовать parquet и сжатием gzip при загрузке файла из API.

Parquet выглядит как небольшая файловая система, где значения каждой колонки лежат в отдельных файлах, а также присутствует дополнительный файл с метаданными, где хранится информация о типах колонок и их расположении. То есть чтобы получить значения заданных колонок нужно прочитать только файлы, содержащие данные этих колонок (а не всё целиком).

### Настройка подключений

В UI Airflow Connections прописать следующие параметры

```
{
  "endpoint_url": "http://host.docker.internal:9000",
  "region_name": "us-east-1"
}
```

`AWS Access Key ID` и `AWS Secret Access Key` создаю в Minio. На боковой панели выбрать `Access Keys` далее `Create access keys`.

![image](https://github.com/user-attachments/assets/2a3f9135-71ac-414b-afc8-2b9d460248f7)

Настройки в самом UI Airflow

![image](https://github.com/user-attachments/assets/bde10bf3-b2e6-4017-a3eb-014b40f4af47)

Подключение к API

Прописать HOST `https://eonet.gsfc.nasa.gov/api/v3/events/?` остальную часть ссылки буду предавать в виде `endpoint` в коде.

![image](https://github.com/user-attachments/assets/c89c9dc4-7569-4524-a4ba-4399541fbbd4)
